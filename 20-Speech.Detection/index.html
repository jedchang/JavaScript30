<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Speech Detection</title>
  </head>
  <body>
    <div class="words" contenteditable="true"></div>

    <script>
      /*----------  å»ºç«‹èªéŸ³è¾¨è­˜ç‰©ä»¶  ----------*/
      // ä¾æ“šä¸åŒç€è¦½å™¨å°‡å…¨åŸŸç’°å¢ƒä¸­çš„ SpeechRecognition åšè¨­å®š
      window.SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;

      // å»ºç«‹èªéŸ³è­˜åˆ¥ SpeechRecognition çš„ç‰©ä»¶
      let recognition = new SpeechRecognition();

      // è¬›è©±çš„ç•¶ä¸‹å³æ™‚è¾¨è­˜ï¼Œä¸éœ€ç­‰å¾… ï¼ˆé è¨­ç‚ºfalse)
      recognition.interimResults = true;

      // è¦è¾¨è­˜çš„èªè¨€ 'en-US', 'zh-TW'
      recognition.lang = 'en-US';

      /*----------  æ–‡å­—å€å¡Š  ----------*/
      let p = document.createElement('p');
      const words = document.querySelector('.words');
      words.appendChild(p);

      /*----------  ç›£è½ä¸¦å¯«å…¥èªéŸ³è³‡æ–™  ----------*/
      recognition.addEventListener('result', e => {
        // å›å‚³è³‡æ–™ç‚º NodeListï¼Œéœ€è¦ç”¨ map ä¾†æ“ä½œï¼Œæ‰€ä»¥è¦è½‰ Array æ‰èƒ½ä½¿ç”¨
        const transcript = Array.from(e.results)
          // é€é map å–å¾—é™£åˆ—çš„ç¬¬ 1 ç­†è³‡æ–™
          .map(result => result[0])
          // å†å–å‡ºç¬¬ 1 ç­†çš„ transcript
          .map(result => result.transcript)
          // ç”¨ join å°‡é€£çµç¬¦è™Ÿæ¶ˆæ‰
          .join('');

        // å°‡å›å‚³çš„æ–‡å­—åšéæ¿¾ (è‹±æ–‡ä¸­ä¸é›…æ–‡å­—)ï¼Œéæ¿¾åŒ…å«ä»¥ä¸‹æ–‡å­—ï¼Œè‹¥æœ‰é«’å­—å‰‡è½‰ç‚ºä¾¿ä¾¿åœ–æ¡ˆ
        const poopScript = transcript.replace(/poop|poo|shit|dump/gi, 'ğŸ’©');
        // éæ¿¾å®Œå¾Œï¼Œå°‡å›å‚³å…§å®¹å¡åˆ° p å…ƒç´ 
        p.textContent = poopScript;

        // å¦‚æœå›å‚³å…§å®¹å·²ç¶“çµæŸï¼ˆä¸€æ®µè©±çš„çµå°¾ï¼‰ï¼Œå°±å†å»ºç«‹ä¸€å€‹æ–°çš„ p å…ƒç´ ä¾†æ”¾ä¸‹ä¸€æ®µæ–‡å­—
        // isFinal æ˜¯å¦ç‚ºæœ€å¾Œçš„è¾¨è­˜çµæœ
        if (e.results[0].isFinal) {
          p = document.createElement('p');
          words.appendChild(p);
        }
      });

      // ç›£è½å¦‚æœèªéŸ³è­˜åˆ¥çµæŸï¼Œå‰‡åœ¨é–‹å•Ÿä¸€æ¬¡æ–°çš„è­˜åˆ¥
      recognition.addEventListener('end', recognition.start);
      // é–‹å•ŸèªéŸ³è­˜åˆ¥æ–¹æ³•
      recognition.start();
    </script>

    <style>
      html {
        font-size: 10px;
      }

      body {
        background: #ffc600;
        font-family: 'helvetica neue';
        font-weight: 200;
        font-size: 20px;
      }

      .words {
        max-width: 500px;
        margin: 50px auto;
        background: white;
        border-radius: 5px;
        box-shadow: 10px 10px 0 rgba(0, 0, 0, 0.1);
        padding: 1rem 2rem 1rem 5rem;
        background: -webkit-gradient(linear, 0 0, 0 100%, from(#d9eaf3), color-stop(4%, #fff)) 0 4px;
        background-size: 100% 3rem;
        position: relative;
        line-height: 3rem;
      }

      p {
        margin: 0 0 3rem;
      }

      .words:before {
        content: '';
        position: absolute;
        width: 4px;
        top: 0;
        left: 30px;
        bottom: 0;
        border: 1px solid;
        border-color: transparent #efe4e4;
      }
    </style>
  </body>
</html>
